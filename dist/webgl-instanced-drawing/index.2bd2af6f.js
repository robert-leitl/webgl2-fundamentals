!function(t,e,i,r,a){var n="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},s="function"==typeof n.parcelRequire9b6a&&n.parcelRequire9b6a,o=s.cache||{},l="undefined"!=typeof module&&"function"==typeof module.require&&module.require.bind(module);function c(e,i){if(!o[e]){if(!t[e]){var r="function"==typeof n.parcelRequire9b6a&&n.parcelRequire9b6a;if(!i&&r)return r(e,!0);if(s)return s(e,!0);if(l&&"string"==typeof e)return l(e);var a=new Error("Cannot find module '"+e+"'");throw a.code="MODULE_NOT_FOUND",a}u.resolve=function(i){var r=t[e][1][i];return null!=r?r:i},u.cache={};var h=o[e]=new c.Module(e);t[e][0].call(h.exports,u,h,h.exports,this)}return o[e].exports;function u(t){var e=u.resolve(t);return!1===e?{}:c(e)}}c.isParcelRequire=!0,c.Module=function(t){this.id=t,this.bundle=c,this.exports={}},c.modules=t,c.cache=o,c.parent=s,c.register=function(e,i){t[e]=[function(t,e){e.exports=i},{}]},Object.defineProperty(c,"root",{get:function(){return n.parcelRequire9b6a}}),n.parcelRequire9b6a=c;for(var h=0;h<e.length;h++)c(e[h]);var u=c(i);"object"==typeof exports&&"undefined"!=typeof module?module.exports=u:"function"==typeof define&&define.amd&&define((function(){return u}))}({"5Kc7i":[function(t,e,i){var r,a,n=t("tweakpane"),s=t("./webgl-instanced-drawing");window.addEventListener("load",(function(){var t,e=document.body.querySelector("#c");t=new n.Pane({title:"Settings"}),r=new s.WebGLInstancedDrawing(e,t,(function(t){t.run()}))})),window.addEventListener("resize",(function(){r&&(a&&clearTimeout(a),a=setTimeout((function(){a=null,r.resize()}),300))}))},{tweakpane:"53J2X","./webgl-instanced-drawing":"EIZtb"}],EIZtb:[function(t,e,i){var r=t("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(i),r.export(i,"WebGLInstancedDrawing",(function(){return p}));var a=t("@swc/helpers"),n=t("twgl.js"),s=(t("../math/m4"),t("./shader/draw.frag")),o=r.interopDefault(s),l=t("./shader/draw.vert"),c=r.interopDefault(l),h=new WeakSet,u=new WeakSet,d=new WeakSet,f=new WeakSet,v=new WeakSet,m=new WeakSet,g=new WeakSet,w=new WeakSet,p=function(){"use strict";function t(e,i){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;a.classCallCheck(this,t),a.defineProperty(this,"oninit",void 0),_.set(this,{writable:!0,value:0}),b.set(this,{writable:!0,value:0}),x.set(this,{writable:!0,value:!1}),a.defineProperty(this,"camera",{rotation:0,position:[0,0,150],matrix:n.m4.identity()}),h.add(this),u.add(this),d.add(this),f.add(this),v.add(this),m.add(this),g.add(this),w.add(this),this.canvas=e,this.pane=i,this.oninit=r,a.classPrivateMethodGet(this,u,A).call(this)}return a.createClass(t,[{key:"resize",value:function(){n.resizeCanvasToDisplaySize(this.gl.canvas),this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight),a.classPrivateMethodGet(this,g,R).call(this)}},{key:"run",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=this;a.classPrivateFieldSet(this,b,t-a.classPrivateFieldGet(this,_)),a.classPrivateFieldSet(this,_,t),a.classPrivateFieldGet(this,x)||(this.drawUniforms.u_deltaTime=a.classPrivateFieldGet(this,b),this.instanceMatrices.forEach((function(t,i){n.m4.rotateY(t,5e-4*a.classPrivateFieldGet(e,b)*(i+1),t)})),a.classPrivateMethodGet(this,h,M).call(this),requestAnimationFrame((function(t){return e.run(t)})))}},{key:"destroy",value:function(){a.classPrivateFieldSet(this,x,!0)}}]),t}(),_=new WeakMap,b=new WeakMap,x=new WeakMap;function M(){this.gl.clearColor(0,0,0,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this.gl.enable(this.gl.DEPTH_TEST),this.gl.enable(this.gl.CULL_FACE),this.gl.useProgram(this.drawProgram),this.gl.bindVertexArray(this.cubeVAO),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.matrixBuffer),this.gl.bufferSubData(this.gl.ARRAY_BUFFER,0,this.instanceMatricesArray),this.gl.uniformMatrix4fv(this.drawLocations.u_worldMatrix,!1,this.drawUniforms.u_worldMatrix),this.gl.uniformMatrix4fv(this.drawLocations.u_viewMatrix,!1,this.drawUniforms.u_viewMatrix),this.gl.uniformMatrix4fv(this.drawLocations.u_projectionMatrix,!1,this.drawUniforms.u_projectionMatrix),this.gl.drawElementsInstanced(this.gl.TRIANGLES,this.cubeBuffers.numElements,this.gl.UNSIGNED_SHORT,0,this.numInstances)}function A(){if(this.gl=this.canvas.getContext("webgl2",{antialias:!0,alpha:!1}),!this.gl)throw new Error("No WebGL 2 context!");this.drawProgram=a.classPrivateMethodGet(this,v,L).call(this,this.gl,[c.default,o.default]),this.drawLocations={a_position:this.gl.getAttribLocation(this.drawProgram,"a_position"),a_normal:this.gl.getAttribLocation(this.drawProgram,"a_normal"),a_uv:this.gl.getAttribLocation(this.drawProgram,"a_uv"),a_instanceMatrix:this.gl.getAttribLocation(this.drawProgram,"a_instanceMatrix"),u_worldMatrix:this.gl.getUniformLocation(this.drawProgram,"u_worldMatrix"),u_viewMatrix:this.gl.getUniformLocation(this.drawProgram,"u_viewMatrix"),u_projectionMatrix:this.gl.getUniformLocation(this.drawProgram,"u_projectionMatrix"),u_deltaTime:this.gl.getUniformLocation(this.drawProgram,"u_deltaTime")},console.log(this.drawLocations),this.cubeBuffers=n.primitives.createCubeBuffers(this.gl),this.cubeVAO=a.classPrivateMethodGet(this,d,P).call(this,this.gl,[[this.cubeBuffers.position,this.drawLocations.a_position,3],[this.cubeBuffers.normal,this.drawLocations.a_normal,3],[this.cubeBuffers.texcoord,this.drawLocations.a_uv,2]],this.cubeBuffers.indices),this.numInstances=9,this.instanceMatricesArray=new Float32Array(16*this.numInstances),this.instanceMatrices=[];for(var t=0;t<this.numInstances;++t){var e=t%3-1,i=Math.floor(t/3)-1,r=n.m4.translation([30*e,30*i,0]),s=new Float32Array(this.instanceMatricesArray.buffer,64*t,16);s.set(r),this.instanceMatrices.push(s)}this.matrixBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.matrixBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.instanceMatricesArray.byteLength,this.gl.DYNAMIC_DRAW);for(var l=0;l<4;++l){var h=this.drawLocations.a_instanceMatrix+l;this.gl.enableVertexAttribArray(h),this.gl.vertexAttribPointer(h,4,this.gl.FLOAT,!1,64,16*l),this.gl.vertexAttribDivisor(h,1)}this.drawUniforms={u_worldMatrix:n.m4.translate(n.m4.scaling([20,20,20]),[0,0,0]),u_viewMatrix:n.m4.identity(),u_projectionMatrix:n.m4.identity()},this.resize(),a.classPrivateMethodGet(this,m,F).call(this),a.classPrivateMethodGet(this,g,R).call(this),a.classPrivateMethodGet(this,w,S).call(this),this.oninit&&this.oninit(this)}function P(t,e,i){var r=t.createVertexArray();t.bindVertexArray(r);var n=!0,s=!1,o=void 0;try{for(var l,c=e[Symbol.iterator]();!(n=(l=c.next()).done);n=!0){var h=a.slicedToArray(l.value,3),u=h[0],d=h[1],f=h[2];t.bindBuffer(t.ARRAY_BUFFER,u),t.enableVertexAttribArray(d),t.vertexAttribPointer(d,f,t.FLOAT,!1,0,0)}}catch(t){s=!0,o=t}finally{try{n||null==c.return||c.return()}finally{if(s)throw o}}return i&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,i),r}function y(t,e,i){var r=t.createShader(e);if(t.shaderSource(r,i),t.compileShader(r),t.getShaderParameter(r,t.COMPILE_STATUS))return r;console.error(t.getShaderInfoLog(r)),t.deleteShader(r)}function L(t,e,i){var r=this,n=t.createProgram();if([t.VERTEX_SHADER,t.FRAGMENT_SHADER].forEach((function(i,s){var o=a.classPrivateMethodGet(r,f,y).call(r,t,i,e[s]);t.attachShader(n,o)})),i&&t.transformFeedbackVaryings(n,i,t.SEPARATE_ATTRIBS),t.linkProgram(n),t.getProgramParameter(n,t.LINK_STATUS))return n;console.error(t.getProgramInfoLog(n)),t.deleteProgram(n)}function F(){n.m4.lookAt(this.camera.position,[0,0,0],[0,1,0],this.camera.matrix),n.m4.inverse(this.camera.matrix,this.drawUniforms.u_viewMatrix)}function R(){var t=this.gl.canvas.clientWidth/this.gl.canvas.clientHeight;n.m4.perspective(Math.PI/4,t,2,250,this.drawUniforms.u_projectionMatrix)}function S(){if(this.pane){var t=this;this.pane.addBlade({view:"slider",label:"c.y",min:-100,max:100,value:this.camera.position[1]}).on("change",(function(e){t.camera.position[1]=e.value,a.classPrivateMethodGet(t,m,F).call(t)})),this.pane.addBlade({view:"slider",label:"c.x",min:-100,max:100,value:this.camera.position[0]}).on("change",(function(e){t.camera.position[0]=e.value,a.classPrivateMethodGet(t,m,F).call(t)}))}}},{"@swc/helpers":"2CIBz","twgl.js":"bpC7N","../math/m4":"d0U9A","./shader/draw.frag":"bFye4","./shader/draw.vert":"g2L1I","@parcel/transformer-js/src/esmodule-helpers.js":"jiucr"}],bFye4:[function(t,e,i){e.exports="#version 300 es\n\nprecision highp float;\n#define GLSLIFY 1\n\nuniform float u_deltaTime;\n\nin vec3 v_normal;\nin vec2 v_uv;\n\nout vec4 outColor;\n\nvoid main() {\n    vec3 n = normalize(v_normal);\n    outColor = vec4(v_normal, 1.) + vec4(v_uv, 0.5, 0.5);\n}\n"},{}],g2L1I:[function(t,e,i){e.exports="#version 300 es\n#define GLSLIFY 1\n\nuniform mat4 u_worldMatrix;\nuniform mat4 u_viewMatrix;\nuniform mat4 u_projectionMatrix;\n\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_uv;\nin mat4 a_instanceMatrix;\n\nout vec3 v_normal;\nout vec2 v_uv;\n\nvoid main() {\n    v_uv = a_uv;\n    v_normal = a_normal;\n    gl_Position = u_projectionMatrix * u_viewMatrix * a_instanceMatrix * u_worldMatrix * vec4(a_position, 1.);\n}\n"},{}]},["5Kc7i"],"5Kc7i");
//# sourceMappingURL=index.2bd2af6f.js.map
