!function(e,t,i,r,n){var o="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},s="function"==typeof o.parcelRequire9b6a&&o.parcelRequire9b6a,a=s.cache||{},l="undefined"!=typeof module&&"function"==typeof module.require&&module.require.bind(module);function u(t,i){if(!a[t]){if(!e[t]){var r="function"==typeof o.parcelRequire9b6a&&o.parcelRequire9b6a;if(!i&&r)return r(t,!0);if(s)return s(t,!0);if(l&&"string"==typeof t)return l(t);var n=new Error("Cannot find module '"+t+"'");throw n.code="MODULE_NOT_FOUND",n}h.resolve=function(i){var r=e[t][1][i];return null!=r?r:i},h.cache={};var c=a[t]=new u.Module(t);e[t][0].call(c.exports,h,c,c.exports,this)}return a[t].exports;function h(e){var t=h.resolve(e);return!1===t?{}:u(t)}}u.isParcelRequire=!0,u.Module=function(e){this.id=e,this.bundle=u,this.exports={}},u.modules=e,u.cache=a,u.parent=s,u.register=function(t,i){e[t]=[function(e,t){t.exports=i},{}]},Object.defineProperty(u,"root",{get:function(){return o.parcelRequire9b6a}}),o.parcelRequire9b6a=u;for(var c=0;c<t.length;c++)u(t[c]);var h=u(i);"object"==typeof exports&&"undefined"!=typeof module?module.exports=h:"function"==typeof define&&define.amd&&define((function(){return h}))}({"04pgW":[function(e,t,i){e("./helpers/bundle-manifest").register(JSON.parse('{"4dZA9":"index.a292e946.js","cJfsF":"f-texture.2ff25e20.png","9LU3i":"index.ba31ca7d.js","9TbUc":"index.5ed48ace.js","2G3CA":"index.15f73c8a.js","eRuGw":"index.3eb9ea76.js"}'))},{"./helpers/bundle-manifest":"gSiLw"}],gSiLw:[function(e,t,i){"use strict";var r={};t.exports.register=function(e){for(var t=Object.keys(e),i=0;i<t.length;i++)r[t[i]]=e[t[i]]},t.exports.resolve=function(e){var t=r[e];if(null==t)throw new Error("Could not resolve bundle with id "+e);return t}},{}],ghnjL:[function(e,t,i){var r,n,o=e("tweakpane"),s=e("./webgl-twgl");window.addEventListener("load",(function(){var e,t=document.body.querySelector("#c");e=new o.Pane({title:"Settings"}),r=new s.WebGLTWGL(t,e,(function(e){e.run()}))})),window.addEventListener("resize",(function(){r&&(n&&clearTimeout(n),n=setTimeout((function(){n=null,r.resize()}),300))}))},{tweakpane:"53J2X","./webgl-twgl":"48QyE"}],"48QyE":[function(e,t,i){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(i),r.export(i,"WebGLTWGL",(function(){return b}));var n=e("@swc/helpers"),o=e("../math/m4"),s=e("chroma-js"),a=r.interopDefault(s),l=e("twgl.js"),u=e("./shader/fragment.glsl"),c=r.interopDefault(u),h=e("./shader/vertex.glsl"),d=r.interopDefault(h),f=new WeakSet,m=new WeakSet,v=new WeakSet,p=new WeakSet,_=new WeakSet,T=new WeakSet,g=new WeakSet,x=new WeakSet,E=new WeakSet,b=function(){"use strict";function t(i,r){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=this;n.classCallCheck(this,t),n.defineProperty(this,"oninit",void 0),w.set(this,{writable:!0,value:0}),R.set(this,{writable:!0,value:!1}),f.add(this),m.add(this),v.add(this),p.add(this),_.add(this),T.add(this),g.add(this),x.add(this),E.add(this),this.canvas=i,this.pane=r,this.oninit=o,this.image=new Image,this.image.src=new URL(e("2ff707e02736d2db")),this.image.onload=function(){n.classPrivateMethodGet(s,p,U).call(s)},n.classPrivateMethodGet(this,v,A).call(this)}return n.createClass(t,[{key:"resize",value:function(){l.resizeCanvasToDisplaySize(this.gl.canvas),this.gl.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height),n.classPrivateMethodGet(this,T,P).call(this)}},{key:"run",value:function(){this.lastFrameTime=performance.now(),n.classPrivateMethodGet(this,f,M).call(this,this.lastFrameTime)}},{key:"destroy",value:function(){n.classPrivateFieldSet(this,R,!0)}},{key:"degToRad",value:function(e){return e*Math.PI/180}},{key:"rand",value:function(e,t){return void 0===t&&(t=e,e=0),e+Math.random()*(t-e)}},{key:"randInt",value:function(e){return Math.floor(Math.random()*e)}}]),t}(),w=new WeakMap,R=new WeakMap;function M(e){var t=this,i=e-this.lastFrameTime;this.lastFrameTime=e,n.classPrivateFieldGet(this,R)||(this.gl.enable(this.gl.CULL_FACE),this.gl.enable(this.gl.DEPTH_TEST),n.classPrivateMethodGet(this,m,j).call(this),this.rotation[1]+=i/3e4*Math.PI*2,n.classPrivateMethodGet(this,x,C).call(this),requestAnimationFrame((function(e){return n.classPrivateMethodGet(t,f,M).call(t,e)})))}function j(){this.gl.clearColor(0,0,0,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this.gl.useProgram(this.program),l.setUniforms(this.uniformSetters,this.uniformsThatAreTheSameForAllObjects),this.gl.bindVertexArray(this.planeVertexArrayObject),this.uniformsThatAreComputedForEachObject.u_world=this.planeModelMatrix,o.m4.transpose(o.m4.inverse(this.planeModelMatrix),this.uniformsThatAreComputedForEachObject.u_worldInverseTranspose),l.setUniforms(this.uniformSetters,this.uniformsThatAreComputedForEachObject),l.setUniforms(this.uniformSetters,this.material2Uniforms),this.gl.drawElements(this.gl.TRIANGLES,this.planeBuffers.numElements,this.gl.UNSIGNED_SHORT,0),this.gl.bindVertexArray(this.objectVertexArrayObject),this.uniformsThatAreComputedForEachObject.u_world=this.modelMatrix,o.m4.transpose(o.m4.inverse(this.modelMatrix),this.uniformsThatAreComputedForEachObject.u_worldInverseTranspose),l.setUniforms(this.uniformSetters,this.uniformsThatAreComputedForEachObject),l.setUniforms(this.uniformSetters,this.material1Uniforms),this.gl.drawElements(this.gl.TRIANGLES,this.objectBuffers.numElements,this.gl.UNSIGNED_SHORT,0)}function A(){this.gl=this.canvas.getContext("webgl2");var e=this.gl;if(!this.gl)throw new Error("No WebGL 2 context!");l.setAttributePrefix("a_"),this.program=l.createProgramFromSources(e,[d.default,c.default]),this.uniformSetters=l.createUniformSetters(e,this.program);var t=l.createAttributeSetters(e,this.program);this.objectBuffers=l.primitives.createCubeBuffers(this.gl,20),this.objectBuffers=l.primitives.createSphereBuffers(this.gl,15,32,32);var i={a_position:{buffer:this.objectBuffers.position,numComponents:3},a_normal:{buffer:this.objectBuffers.normal,numComponents:3},a_texcoord:{buffer:this.objectBuffers.texcoord,numComponents:2}};this.objectVertexArrayObject=l.createVAOAndSetAttributes(e,t,i,this.objectBuffers.indices),this.planeBuffers=l.primitives.createPlaneBuffers(this.gl,100,100,1,1);var r={a_position:{buffer:this.planeBuffers.position,numComponents:3},a_normal:{buffer:this.planeBuffers.normal,numComponents:3},a_texcoord:{buffer:this.planeBuffers.texcoord,numComponents:2}};this.planeVertexArrayObject=l.createVAOAndSetAttributes(e,t,r,this.planeBuffers.indices),this.imageTexture=n.classPrivateMethodGet(this,_,S).call(this,this.gl),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,1,1,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,new Uint8Array([255,255,255,255]));var s=e.createTexture();e.bindTexture(e.TEXTURE_2D,s);var u=e.LUMINANCE,h=e.LUMINANCE,f=e.UNSIGNED_BYTE,m=new Uint8Array([255,128,255,128,255,128,255,128,128,255,128,255,128,255,128,255,255,128,255,128,255,128,255,128,128,255,128,255,128,255,128,255,255,128,255,128,255,128,255,128,128,255,128,255,128,255,128,255,255,128,255,128,255,128,255,128,128,255,128,255,128,255,128,255]);e.pixelStorei(e.UNPACK_ALIGNMENT,1),e.texImage2D(e.TEXTURE_2D,0,u,8,8,0,h,f,m),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),this.material1Uniforms={u_colorMult:a.default.hsv(0,0,1).gl(),u_ambient:[.2,.2,.2,1],u_diffuse:s,u_specular:[1,1,1,1],u_shininess:50,u_specularFactor:.7,u_projectedTexture:this.imageTexture},this.material2Uniforms={u_colorMult:a.default.hsv(200,1,1).gl(),u_ambient:[.1,.1,.1,1],u_diffuse:s,u_specular:[1,1,1,1],u_shininess:5,u_specularFactor:.25,u_projectedTexture:this.imageTexture},this.origin=[0,0,0],this.translation=[0,0,0],this.scale=[1,1,1],this.rotation=[0,0,0],n.classPrivateMethodGet(this,x,C).call(this),this.planeModelMatrix=o.m4.translation(0,-15,0),n.classPrivateMethodGet(this,T,P).call(this),this.cameraRotationY=0,n.classPrivateMethodGet(this,g,y).call(this);var v=o.m4.lookAt([50,50,50],[0,0,0],[0,-1,0]);o.m4.scale(v,.32,.32,1,v);var p=o.m4.perspective(this.degToRad(45),1,.1,200);this.uniformsThatAreTheSameForAllObjects={u_projection:this.projectionMatrix,u_view:this.viewMatrix,u_lightWorldPos:[-100,100,100],u_viewInverse:this.cameraMatrix,u_lightColor:[1,1,1,1],u_textureMatrix:o.m4.multiply(p,o.m4.inverse(v))},this.uniformsThatAreComputedForEachObject={u_world:o.m4.identity(),u_worldInverseTranspose:o.m4.identity()},this.resize(),n.classPrivateMethodGet(this,E,L).call(this),this.oninit&&this.oninit(this)}function U(){this.gl.bindTexture(this.gl.TEXTURE_2D,this.imageTexture),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,this.image),this.gl.generateMipmap(this.gl.TEXTURE_2D)}function S(e){var t=e.createTexture();return e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),t}function P(){var e=this.gl.canvas.clientWidth/this.gl.canvas.clientHeight,t=Math.PI/180*75;this.projectionMatrix=o.m4.perspective(t,e,1,2e3)}function y(){this.cameraMatrix=o.m4.yRotation(this.cameraRotationY),this.cameraMatrix=o.m4.translate(this.cameraMatrix,0,0,50),this.viewMatrix=o.m4.inverse(this.cameraMatrix,this.viewMatrix)}function C(){this.modelMatrix=o.m4.translation(this.translation[0],this.translation[1],this.translation[2]),this.modelMatrix=o.m4.xRotate(this.modelMatrix,this.rotation[0]),this.modelMatrix=o.m4.yRotate(this.modelMatrix,this.rotation[1]),this.modelMatrix=o.m4.zRotate(this.modelMatrix,this.rotation[2]),this.modelMatrix=o.m4.scale(this.modelMatrix,this.scale[0],this.scale[1],this.scale[2]),this.modelMatrix=o.m4.translate(this.modelMatrix,-this.origin[0],-this.origin[1],-this.origin[2])}function L(){if(this.pane){var e=this;this.pane.addBlade({view:"slider",label:"camera RY",min:0,max:2*Math.PI,value:0}).on("change",(function(t){e.cameraRotationY=t.value,n.classPrivateMethodGet(e,g,y).call(e)}))}}},{"@swc/helpers":"2CIBz","../math/m4":"d0U9A","chroma-js":"lAOe9","twgl.js":"bpC7N","./shader/fragment.glsl":"bCTXU","./shader/vertex.glsl":"6qJbU","2ff707e02736d2db":"jfieQ","@parcel/transformer-js/src/esmodule-helpers.js":"jiucr"}],bCTXU:[function(e,t,i){t.exports="#version 300 es\nprecision highp float;\n#define GLSLIFY 1\n \nin vec4 v_position;\nin vec2 v_texCoord;\nin vec3 v_normal;\nin vec3 v_surfaceToLight;\nin vec3 v_surfaceToView;\nin vec4 v_projectedTexcoord;\n \nuniform vec4 u_lightColor;\nuniform vec4 u_ambient;\nuniform sampler2D u_diffuse;\nuniform sampler2D u_projectedTexture;\nuniform vec4 u_specular;\nuniform float u_shininess;\nuniform float u_specularFactor;\nuniform vec4 u_colorMult;\n \nout vec4 outColor;\n \nvec4 lit(float l ,float h, float m) {\n  return vec4(1.0,\n              max(l, 0.0),\n              (l > 0.0) ? pow(max(0.0, h), m) : 0.0,\n              1.0);\n}\n \nvoid main() {\n    // divide by w to get the correct value\n    vec3 projectedTexcoord = v_projectedTexcoord.xyz / v_projectedTexcoord.w;\n    projectedTexcoord = projectedTexcoord * 0.5 + 0.5;\n    \n    bool inRange = \n        projectedTexcoord.x >= 0.0 &&\n        projectedTexcoord.x <= 1.0 &&\n        projectedTexcoord.y >= 0.0 &&\n        projectedTexcoord.y <= 1.0;\n    float projectedAmount = inRange ? 1.0 : 0.0;\n    vec4 projectedTexColor = texture(u_projectedTexture, projectedTexcoord.xy);\n\n    vec4 diffuseColor = texture(u_diffuse, v_texCoord) * u_colorMult;\n    vec4 combinedColor = mix(diffuseColor, projectedTexColor, projectedAmount);\n    vec3 a_normal = normalize(v_normal);\n    vec3 surfaceToLight = normalize(v_surfaceToLight);\n    vec3 surfaceToView = normalize(v_surfaceToView);\n    vec3 halfVector = normalize(surfaceToLight + surfaceToView);\n    vec4 litR = lit(dot(a_normal, surfaceToLight), dot(a_normal, halfVector), u_shininess);\n    outColor = vec4((u_lightColor * (combinedColor * litR.y + combinedColor * u_ambient + u_specular * litR.z * u_specularFactor)).rgb, diffuseColor.a);\n}"},{}],"6qJbU":[function(e,t,i){t.exports="#version 300 es\n#define GLSLIFY 1\n \nuniform mat4 u_projection;\nuniform mat4 u_view;\nuniform vec3 u_lightWorldPos;\nuniform mat4 u_world;\nuniform mat4 u_viewInverse;\nuniform mat4 u_worldInverseTranspose;\nuniform mat4 u_textureMatrix;\n \nin vec4 a_position;\nin vec3 a_normal;\nin vec2 a_texcoord;\n \nout vec4 v_position;\nout vec2 v_texCoord;\nout vec3 v_normal;\nout vec3 v_surfaceToLight;\nout vec3 v_surfaceToView;\nout vec4 v_projectedTexcoord;\n \nvoid main() {\n    vec4 worldPosition = u_world * a_position;\n    v_texCoord = a_texcoord;\n    v_position = u_projection * u_view * worldPosition;\n    v_normal = (u_worldInverseTranspose * vec4(a_normal, 0)).xyz;\n    v_surfaceToLight = u_lightWorldPos - worldPosition.xyz;\n    v_surfaceToView = (u_viewInverse[3] - worldPosition).xyz;\n    v_projectedTexcoord = u_textureMatrix * worldPosition;\n    gl_Position = v_position;\n}"},{}],jfieQ:[function(e,t,i){t.exports=e("./helpers/bundle-url").getBundleURL("4dZA9")+"../"+e("./helpers/bundle-manifest").resolve("cJfsF")},{"./helpers/bundle-url":"a2ypy","./helpers/bundle-manifest":"gSiLw"}],a2ypy:[function(e,t,i){"use strict";var r={};function n(e){return(""+e).replace(/^((?:https?|file|ftp):\/\/.+)\/[^/]+$/,"$1")+"/"}i.getBundleURL=function(e){var t=r[e];return t||(t=function(){try{throw new Error}catch(t){var e=(""+t.stack).match(/(https?|file|ftp):\/\/[^)\n]+/g);if(e)return n(e[2])}return"/"}(),r[e]=t),t},i.getBaseURL=n,i.getOrigin=function(e){var t=(""+e).match(/(https?|file|ftp):\/\/[^/]+/);if(!t)throw new Error("Origin not found");return t[0]}},{}]},["04pgW","ghnjL"],"ghnjL");
//# sourceMappingURL=index.a292e946.js.map
